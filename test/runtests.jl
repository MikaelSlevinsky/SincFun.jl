using SincFun
using Base.Test

x = linspace(-1,1,101)

sf = sincfun(exp)

@test norm(sf[x]-exp(x)) < 100eps(eltype(sf))

println("Time for 101 samples should be <0.002 seconds.")
@time sf[x]

@test_approx_eq sum(sf) 2sinh(1)

for p in [2,4,6]
    @test_approx_eq norm(sf,p) (2/p*sinh(p))^(1/p)
end

sfs = sincfun(x->sinpi(5x))
sfc = sincfun(x->cospi(5x))

@test norm(sfs[x]-5Ï€*cumsum(sfc)[x]+sinpi(5)) < 200eps(eltype(sfs))

@test norm(roots(sfc) - linspace(-0.9,0.9,10)) < 200eps(eltype(sfc))

println("Time for 10 roots should be <0.80 seconds.")
@time roots(sfc)


h = ConformalMap(1.0,0.1.^(1:4))

@test norm(h[inv(h,x)]-x) < 10eps()

println("Time for 101 samples and inverses of a ConformalMap should be < 0.0002 seconds.")
@time h[inv(h,x)]

println("Testing sinc differentiation and indefinite integration matrices.")

k=collect(-5.0:5.0)
@test_approx_eq sinc(-1,k) [-0.020107164191308535,0.025030330116344923,-0.03309323761827199,0.04858833320985967,-0.08948987223608373,0.5,1.0894898722360837,0.9514116667901403,1.033093237618272,0.9749696698836551,1.0201071641913084]
@test_approx_eq sinc(0,k) [0.0,0.0,0.0,0.0,0.0,1.0,-0.0,-0.0,-0.0,-0.0,-0.0]
@test_approx_eq sinc(1,k) [0.2,-0.25,0.3333333333333333,-0.5,1.0,0.0,-1.0,0.5,-0.3333333333333333,0.25,-0.2]
@test_approx_eq sinc(2,k) [0.08,-0.125,0.2222222222222222,-0.5,2.0,-3.289868133696453,2.0,-0.5,0.2222222222222222,-0.125,0.08]
@test_approx_eq sinc(3,k) [-1.9259208802178716,2.373651100272339,-3.06764591147423,4.184802200544679,-3.8696044010893575,0.0,3.8696044010893575,-4.184802200544679,3.06764591147423,-2.373651100272339,1.9259208802178716]
@test_approx_eq sinc(4,k) [-1.5407367041742974,2.373651100272339,-4.090194548632306,8.369604401089358,-15.47841760435743,19.481818206800483,-15.47841760435743,8.369604401089358,-4.090194548632306,2.373651100272339,-1.5407367041742974]
@test_approx_eq sinc(5,k) [17.94108150262619,-21.385208883160185,25.65270609694696,-27.78053451427782,20.017003012215273,0.0,-20.017003012215273,27.78053451427782,-25.65270609694696,21.385208883160185,-17.94108150262619]
@test_approx_eq sinc(6,k) [21.529297803151426,-32.077813324740276,51.30541219389392,-83.34160354283345,120.10201807329163,-137.3413133679006,120.10201807329163,-83.34160354283345,51.30541219389392,-32.077813324740276,21.529297803151426]
@test_approx_eq sinc(7,k) [-162.13682179064884,184.21112507553056,-200.75043607268225,188.998984387735,-120.67506706226273,0.0,120.67506706226273,-188.998984387735,200.75043607268225,-184.21112507553056,162.13682179064884]
